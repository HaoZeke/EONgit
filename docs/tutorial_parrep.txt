.. _tutorial_parrep:

===================================
Running a Parallel Replica Job
===================================

Regular Parallel Replica Job
-----------------------------

A sample parallel replica simulation can be found in your copy of eon under the directory: ``samples/pr-AlAdatom/``. There are 3 scripts ``init``, ``run``, ``clean`` in this directory. Execute ``init`` first to get 2 input files ``config.ini`` and ``reactant.con`` required for eon simlution.

The system we are looking at is the diffusion of Al adatom on Al(100) surface. A snapshot of the system is given below:

..  image:: fig/aladatom1.png
    :align: center

Here is the ``config.ini`` file which will run a parallel replica job using 1 local cpu for 1 search. 

.. literalinclude:: ../samples/pr-AlAdatom/.config.ini

Now we can run 1 search by executing the script ``run``::

    $ ./run 
    All input files are ready, start to run this sample job 
    simulation time is 0.000000e+00
    state list path does not exist, creating .//states/
    registering results
    0 (result) searches processed
    time in current state is 0.000000e+00
    0 searches in the queue
    making 1 searches
    job finished in .//jobs/scratch/0_0
    1 searches created
    simulation time is 0.000000e+00
    registering results
    found transition with time 6.036e-12
    1 (result) searches processed
    time in current state is 0.000000e+00
    currently in state 1
    0 searches in the queue
    making 0 searches

Here Eon makes 1 searches, the dynamic information of these searches are printed in the ``dynamics.txt``, 

.. literalinclude:: ../samples/pr-aladatom/.dynamics.txt

The first column is the label the successful searches, in this case all the three searches are successful. The second and fouth column label the reactant and product; Column 5 and Column 6 are the transition time for each success searches and the accumulated simulation time.
    
Detailed information of the simulation is stored in the folder ``states``. where the geometric and energy of the visited states are stored in the sub-folder labeled as state id. You can find the geometric of the prodcut in ``states/1/reactant.con/``, a snapshot is shown below:

..  image:: fig/aladatom2.png 
    :align: center

Compared to the reactant geometric, we can tell that the transition we found follows the exchange mechanism.

Parallel Replica with Hyperdynamics
----------------------------------
If you want to run Hyperdynamics, you can turn on the Hyperdynamics function by adding the following section to you ``config.ini`` file::

    [Hyperdynamics]
    bias_potential=bond_boost ;using bond_boost scheme for the bias potential
    bb_boost_atomlist=0,1,2,3,4,5,6 ;atoms that are tagged, those bonds involving these atoms and shorter than bb_rcut will be boosted
    bb_rcut=3.0 
    bb_rmd_steps=100 ;number of regular md steps to get equilibrium configuration.
    bb_dvmax=0.4 ;the magnitude of the bond-boost bias potential.
    bb_stretch_threshold=0.2  ;defines the bond-boost dividing surface. It should be smaller than the maximum fractional nearest-neighbor bond stretch or compression at any transition state
    bb_ds_curvature=0.95   ;the curvature near the bond-boost dividing surface, it should has a value <= 1. We recommend the value to be 0.9-0.98
   
All the other setting and print-out infomation are similar to the regular parallel replica simulation.
